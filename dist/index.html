<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<link rel="apple-touch-icon" sizes="76x76" href="assets/img/apple-icon.png">
	<link rel="icon" type="image/png" href="assets/img/favicon.png">
	<title>MARStorage</title>
	<link href="https://fonts.googleapis.com/css?family=Poppins:200,300,400,600,700,800" rel="stylesheet" />
	<link href="https://use.fontawesome.com/releases/v5.0.6/css/all.css" rel="stylesheet">
	<link href="assets/css/style.css" rel="stylesheet" /> </head>

<body class="landing-page">
	<nav class="navbar navbar-expand-lg fixed-top navbar-transparent " color-on-scroll="100">
		<div class="container">
			<div class="navbar-translate">
				<a class="navbar-brand" href="/" rel="tooltip" title="Go to homepage" data-placement="bottom"> <span>MARS</span>torage </a>
				<button class="navbar-toggler navbar-toggler" type="button" data-toggle="collapse" data-target="#navigation" aria-controls="navigation-index" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-bar bar1"></span> <span class="navbar-toggler-bar bar2"></span> <span class="navbar-toggler-bar bar3"></span> </button>
			</div>
			<div class="collapse navbar-collapse justify-content-end" id="navigation">
				<div class="navbar-collapse-header">
					<div class="row">
						<div class="col-6 collapse-brand">
							<a>MARStorage</a>
						</div>
						<div class="col-6 collapse-close text-right">
							<button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navigation" aria-controls="navigation-index" aria-expanded="false" aria-label="Toggle navigation"> <i class="tim-icons icon-simple-remove"></i> </button>
						</div>
					</div>
				</div>
				<ul class="navbar-nav">
					<li class="nav-item p-0">
						<a class="nav-link hide-if-logged-in" href="#" onclick="skyid.sessionStart();">
							<p id="login">Login/Register with SkyID</p>
						</a>
						<a class="nav-link show-if-logged-in" style="display: none;" href="javascript:skyid.sessionDestroy();">
							<p id="login">Logout</p>
						</a>
					</li>
					<!-- <li class="nav-item p-0">
						<a class="nav-link" rel="tooltip" title="Follow us on Twitter" data-placement="bottom" href="javascript:void(0);"> <i class="fab fa-twitter"></i>
							<p class="d-lg-none d-xl-none">Twitter</p>
						</a>
					</li>
					<li class="nav-item p-0">
						<a class="nav-link" rel="tooltip" title="Like us on Facebook" data-placement="bottom" href="javascript:void(0);"> <i class="fab fa-facebook-square"></i>
							<p class="d-lg-none d-xl-none">Facebook</p>
						</a>
					</li>
					<li class="nav-item p-0">
						<a class="nav-link" rel="tooltip" title="Follow us on Instagram" data-placement="bottom" href="javascript:void(0);"> <i class="fab fa-instagram"></i>
							<p class="d-lg-none d-xl-none">Instagram</p>
						</a>
					</li> -->
				</ul>
			</div>
		</div>
	</nav>
	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<div id="home" class="hide-if-logged-in">
    <div class="page-header">
      <img src="assets/img/blob.png" class="path">
      <img src="assets/img/path2.png" class="path2">
      <img src="assets/img/triunghiuri.png" class="shapes triangle">
      <img src="assets/img/waves.png" class="shapes wave">
      <img src="assets/img/patrat.png" class="shapes squares">
      <img src="assets/img/cercuri.png" class="shapes circle">
      <div class="content-center">
        <div class="row row-grid justify-content-between align-items-center text-left">
          <div class="col-lg-6 col-md-6">
            <h1 class="text-white">Own your data
            </h1>
            <p class="text-white mb-3">All files are encrypted in your browser and stored on the decentralized Sia Skynet</p>
            <div class="btn-wrapper mb-3">
              <p class="category text-success d-inline"><a href="#" onclick="skyid.sessionStart()">Secure login/register with SkyID</a></p>
            </div>
          </div>
          <div class="col-lg-4 col-md-5">
            <img src="assets/img/skynet.png" alt="Circle image" class="img-fluid">
          </div>
        </div>
      </div>
    </div>
  </div>
	<div id="storage" class="show-if-logged-in" style="display: none;">
		<nav class="navbar navbar-light bg-light navbar-expand-lg" style="background: #1ED660 !important; margin-top: 100px !important;">
			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarTogglerDemo02" aria-controls="navbarTogglerDemo02" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button>
			<div class="collapse navbar-collapse" id="navbarTogglerDemo02">
				<div class="navbar-nav float-rightd ml-auto">
					<li class="nav-item"><a class="nav-link mx-1" title="New folder" href="#" onmousedown="newfolder()"><i class="fa fa-folder fa-fw" aria-hidden="true"></i> New Folder</a></li>
					<li class="nav-item"><a class="nav-link mx-1" title="Upload files" href="#" onmousedown="show_upload()"><i class="fa fa-cloud-upload fa-fw" aria-hidden="true"></i> Upload Files</a></li>
				</div>
			</div>
		</nav>
		<form class="mt-3 mx-3" action="" method="post">
			<input type="hidden" name="p" value="">
			<input type="hidden" name="group" value="1">
			<div class="row">
				<div class="col-sm-3">
					<div class="file-tree-view border w-100" id="file-tree-view">
						<div style="color: #fff;" class="tree-title"><i class="fa fa-align-left fa-fw"></i> Browse</div>
						<div id="tree"></div>
					</div>
				</div>
				<div class="col-sm-9 mt-3 mt-md-0">
					<div class="table-responsive">
						<table class="table" id="main-table">
							<thead>
								<tr>
									<th style="width:3%">
										<label>
											<input type="checkbox" title="Invert selection" onclick="checkbox_toggle()"> </label>
									</th>
									<th>Name</th>
									<th style="width:10%">Size</th>
									<th style="width:15%">Modified</th>
									<th style="width:15%">Actions</th>
								</tr>
							</thead>
							<tbody id="name" style="border-top: 0.125rem solid #e3e3e3;"></tbody>
							<tr>
								<td class="gray"></td>
								<td class="gray" colspan="6"> Full size: <span id="fullsize"></span>, files: <span id="filecount"></span>, folders: <span id="foldercount"></span></td>
							</tr>
						</table>
					</div>
				</div>
			</div>
			<div class="mb-5 row">
				<div class="col-sm-9 offset-sm-3"><a href="#/select-all" class="mt-2 mt-sm-0 btn2 btn btn-small btn-outline-primary" onclick="select_all();return false;"><i class="fa fa-check-square"></i> Select all</a> &nbsp; <a href="#/unselect-all" class="mt-2 mt-sm-0 btn2 btn btn-small btn-outline-primary" onclick="unselect_all();return false;"><i class="fa fa-window-close"></i> Unselect all</a> &nbsp; <a href="#/invert-all" class="mt-2 mt-sm-0 btn2 btn btn-small btn-outline-primary" onclick="invert_all();return false;"><i class="fa fa-th-list"></i> Invert selection</a> &nbsp;
					<input type="submit" class="hidden" name="delete" id="a-delete" value="Delete" onclick="return confirm('Delete selected files and folders?')"> <a href="javascript:document.getElementById('a-delete').click();" class="mt-2 mt-sm-0 btn2 btn btn-small btn-outline-primary"><i class="fa fa-trash"></i> Delete </a> &nbsp;
					<!--<input type="submit" class="hidden" name="copy" id="a-copy" value="Copy"> <a href="#" onmousedown="document.getElementById('a-copy').click()" class="mt-2 mt-sm-0 btn2 btn btn-small btn-outline-primary"><i class="fa fa-files-o"></i> Copy </a> </div>-->
			</div>
		</form>
		<a id="link" href=""></a>
	</div>
	<div>
		<footer class="footer">
			<div class="container">
				<div class="row">
					<div class="col-md-3">
						<h1 class="title">MARStorage</h1> </div>
					<div class="col-md-3">
						<!-- <ul class="nav">
							<li class="nav-item">
								<a href="javascript:void(0);" class="nav-link">Home</a>
							</li>
							<li class="nav-item">
								<a href="javascript:void(0);" class="nav-link">Login</a>
							</li>
							<li class="nav-item">
								<a href="javascript:void(0);" class="nav-link">Register</a>
							</li>
						</ul> -->
					</div>
					<div class="col-md-3">
						<!-- <ul class="nav">
							<li class="nav-item"> 
								<a href="javascript:void(0);" class="nav-link">Contact Us</a>
							</li>
							<li class="nav-item">
								<a href="javascript:void(0);" class="nav-link">About Us</a>
							</li>
							<li class="nav-item">
								<a href="javascript:void(0);" class="nav-link">Blog</a>
							</li>
						</ul> -->
					</div>
					<div class="col-md-3">
						<h3 class="title">We kindly recommend:</h3>
						<div class="btn-wrapper profile">
							<a href="https://twitter.com/CoolHDstudio" class="btn btn-icon btn-neutral btn-round btn-simple" data-toggle="tooltip" data-original-title="Follow us"> <i class="fab fa-twitter"></i> </a>
							<a href="https://skylive.coolhd.hu" class="btn btn-icon btn-neutral btn-round btn-simple" data-toggle="tooltip" data-original-title="Watch SkyLive, decentralized video platform"> <i class="fa fa-play-circle"></i> </a>
							<a href="https://filebase.com/" class="btn btn-icon btn-neutral btn-round btn-simple" data-toggle="tooltip" data-original-title="Check out Filebase for managed S3 storage"> <i class="fas fa-save"></i> </a>
						</div>
					</div>
				</div>
			</div>
		</footer>

		<script src="https://sky-id.hns.siasky.net/skyid.js"></script>
		<script src="main.js"></script>

		<script>

		function skyidCallback(message) {
			if (message == 'login_success') {
				loadfiles()
			}
		}

		var skyid = new SkyID('Marstorage', skyidCallback, { 'devMode': true })
		if (skyid.seed != '') {
			loadfiles()
		}

		function saveFiles(files) {
			skyid.setJSON('index', JSON.stringify(files), function(response) {
				if (response != true) {
					alert('Sorry, failed to save your index, please retry')
				}
			})
		}
	
		var files = []
		var currentPath = '' // where the user navigated
		function getdata(getname = "", getpath = "", getstatus = "") {
			var fullsize = 0;
			var filecount = 0;
			var foldercount = 0;
			var tbody = "";
			var tbodypart = "";
			if(getpath !== "") {
				currentPath = getpath
				console.log('currentPath', currentPath)
				tbody = `<tr><td></td><td colspan="6"><a href="#" onmousedown="getdata(${name}, ${path})"><i class="fa fa-chevron-circle-left"></i> ..</a></td></tr>`;
			}
			var treearray = new Array();
			treearray.push("Root folder");
			for(i = 0; i < files.length; i++) {
				var type = files[i]["type"];
				var name = files[i]["name"];
				var status = files[i]["status"];
				if (type === "Folder" && status != 'delete') {
					treearray.push(name);
				}
			}
			var j;
			var tree = `<ul class="tree">`;
			var fullname;
			for(i = 0; i < treearray.length; i++) {
	   			tree += `<li><label><a>${textlimit(treearray[i])}</a></label><input checked="" type="checkbox"><ul>`;
				for (j = 0; j < files.length; j++) {
					var type = files[j]["type"];
					var path = files[j]["path"];
					var name = files[j]["name"];
					var status = files[j]["status"];
					if (path === "") {
						path = "Root folder";
					}
					if(type !== "Folder" && treearray[i] === path && status != 'delete') {
						fullname = name + '.' + type;
						tree += `<li><a><label>${textlimit(fullname)}</label><input checked="" type="checkbox"></a></li>`;
					}
				}
				tree += `</ul>`;
			}
			tree += `</ul>`;
			document.getElementById("tree").innerHTML = tree;
			for(i = 0; i < files.length; i++) {
				var type = files[i]["type"];
				var size = files[i]["size"];
				var date = files[i]["date"];
				var path = files[i]["path"];
				var url = files[i]["url"];
				var status = files[i]["status"];
				var name = files[i]["name"];
				if(getstatus === "delete") {
					if(getname === name && getpath === path) {
						files[i]["status"] = "delete";
					}
				}
				if(getstatus === "rename") {
					if(getname === name && getpath === path) {
						var newname = prompt("New name");
						if (newname) {
							files[i]["name"] = newname;
						}
					}
				}
				status = files[i]["status"];
				name = files[i]["name"];
				date = new Date(date * 1000);
				date = ('0' + date.getUTCDate()).slice(-2) + '.' + ('0' + (date.getUTCMonth() + 1)).slice(-2) + '.' + ('0' + date.getUTCFullYear()).slice(-2) + ' ' + ('0' + date.getUTCHours()).slice(-2) + ':' + ('0' + date.getUTCMinutes()).slice(-2);
				if(path === getpath && status === "") {
					if(type === "Folder") {
						tbodypart = `<tr>
                    <td>
                        <label>
                            <input type="checkbox" name="file[]" value="${name}">
                        </label>
                    </td>
                    <td>
                        <div class="filename">
                            <a href="#" onmousedown="getdata('${name}', '${name}')"><i class="fa fa-folder-o"></i> ${name}</a>
                        </div>
                    </td>
                    <td>${type}</td>
                    <td>${date}</td>
                    <td class="inline-actions">
                        <a title="Delete" href="#" onmousedown="getdata('${name}', '${path}', 'delete')" onclick="return confirm('Delete folder?');">
                            <i class="fa fa-trash-o" aria-hidden="true"></i>
                        </a>
                        <a title="Rename" href="#" onmousedown="getdata('${name}', '${path}', 'rename')">
                            <i class="fa fa-pencil-square-o" aria-hidden="true"></i>
                        </a>
                        <a title="Move to..." href="#" onmousedown="getdata('${name}', '${path}', 'move')">
                            <i class="fa fa-arrows" aria-hidden="true"></i>
                        </a>
                        <a title="Direct link" href="${url}" target="_blank">
                            <i class="fa fa-link" aria-hidden="true"></i>
                        </a>
                    </td>
                </tr>`;
						tbody += tbodypart;
						foldercount++;
					} else {
						tbodypart = `<tr>
                    <td>
                        <label>
                            <input type="checkbox" name="file[]" value="${name}.${type}">
                        </label>
                    </td>
                    <td>
                        <div class="filename">
                            <a href="${url}" title="File info"><i class="${fileicon(type)}"></i> ${name}.${type}</a>
                        </div>
                    </td>
                    <td><span title="8 bytes">${filesize(size)}</span></td>
                    <td>${date}</td>
                    <td class="inline-actions">
                        <a title="Delete" href="#" onmousedown="getdata('${name}', '${path}', 'delete')" onclick="return confirm('Delete file?');">
                            <i class="fa fa-trash-o"></i>
                        </a>
                        <a title="Rename" href="#" onmousedown="getdata('${name}', '${path}', 'rename')">
                            <i class="fa fa-pencil-square-o"></i>
                        </a>
                        <a title="Move to..." href="#" onmousedown="getdata('${name}', '${path}', 'move')">
                            <i class="fa fa-arrows"></i>
                        </a>
                        <a title="Direct link" href="${url}" target="_blank">
                            <i class="fa fa-link"></i>
                        </a>
                        <a title="Download" href="#" onmousedown="getdata('${name}', '${path}', 'download')">
                            <i class="fa fa-download"></i>
                        </a>
                    </td>
                </tr>`;
						tbody += tbodypart;
						filecount++;
						fullsize += size;
					}
				}
			}
			document.getElementById("name").innerHTML = tbody;
			if(getstatus === "") {
				console.log("Json loaded");
			} else if(getstatus === "upload") {
				console.log("File uploaded");
			} else if(getstatus === "delete") {
				console.log("File deleted");
			} else if(getstatus === "rename") {
				console.log("File renamed");
			}

			if (getstatus != '') {
				saveFiles(files)
			}
			document.getElementById("fullsize").innerHTML = filesize(fullsize);
			document.getElementById("filecount").innerHTML = filecount;
			document.getElementById("foldercount").innerHTML = foldercount;
			
		}

		function submit(path) {
			var all = document.getElementById("file");
			for(var i = 0; i < all.files.length; i++) {
				var file = all.files[i];
				window.uploadSkyfile(file, function(skylink) {
					var fileurl = skylink;
					var filename = file["name"].split('.').slice(0, -1).join('.');
					var filetype = file["name"].split('.').pop();
					var length = files.length;
					files[length] = {
						name: filename,
						type: filetype,
						size: file["size"],
						date: Date.now(),
						path: path,
						url: fileurl,
						status: ""
					};
					getdata(path, path, 'finish_upload');
				});
			}
		}


		function show_upload() {
			tbody = `<style>
				#hide input[type=file] {
					display:none;
					margin:10px;
				}
				#hide input[type=file] + label {
					display:inline-block;
					margin:20px;
					padding: 4px 32px;
					background-color: #FFFFFF;
					border:solid 1px #666F77;
					border-radius: 6px;
					color:#666F77;
				}
				#hide input[type=file]:active + label {
					background-image: none;
					background-color:#2D6C7A;
					color:#FFFFFF;
				}
			</style>
			<div class="container mt-3">
				<p><h4><b>Uploading files</b></h4></p>
				<p class="break-word">Destination folder:</p>
				<hr>
					<div class="p-2">
						<input class="btn2" type="file" id="file" multiple/><br>
					</div>
					<br>
					<p>
						<a type="submit" class="btn btn-primary" href="#" onmousedown="submit('` + currentPath + `')"><i class="fa fa-upload"></i> Upload</a> &nbsp;
						<b><a href="#" onmousedown="getdata('` + currentPath + `', '` + currentPath + `', '')" class="text-secondary"><i class="fa fa-times-circle"></i> Cancel</a></b>
					</p>
			</div>`;
			document.getElementById("name").innerHTML = tbody;
		}

		function change_checkboxes(e, t) {
			for(var n = e.length - 1; n >= 0; n--) e[n].checked = "boolean" == typeof t ? t : !e[n].checked
		}

		function get_checkboxes() {
			for(var e = document.getElementsByName("file[]"), t = [], n = e.length - 1; n >= 0; n--)(e[n].type = "checkbox") && t.push(e[n]);
			return t
		}

		function select_all() {
			change_checkboxes(get_checkboxes(), !0)
		}

		function unselect_all() {
			change_checkboxes(get_checkboxes(), !1)
		}

		function invert_all() {
			change_checkboxes(get_checkboxes())
		}

		function checkbox_toggle() {
			var e = get_checkboxes();
			e.push(this), change_checkboxes(e)
		}

		function filesize(size) {
			if (size < 1000) {
				return `${size} B`;
			} else if ((size / 1024) < 1000) {
        		return `${Math.round(size/1024)} KiB`;
			} else if ((size / 1024 / 1024) < 1000) {
        		return `${Math.round(size / 1024 / 1024)} MiB`;
			} else if ((size / 1024 / 1024 / 1024) < 1000) {
        		return `${Math.round(size / 1024 / 1024 / 1024)} GiB`;
			} else {
        		return `${Math.round(size / 1024 / 1024 / 1024 / 1024)} TiB`;
			}
		}

		function fileicon(type) {
			switch (type) {
				case 'ico': case 'gif': case 'jpg': case 'jpeg': case 'jpc': case 'jp2':
				case 'jpx': case 'xbm': case 'wbmp': case 'png': case 'bmp': case 'tif':
				case 'tiff': case 'svg':
				img = 'fa fa-picture-o';
				break;
				case 'passwd': case 'ftpquota': case 'sql': case 'js': case 'json': case 'sh':
				case 'config': case 'twig': case 'tpl': case 'md': case 'gitignore':
				case 'c': case 'cpp': case 'cs': case 'py': case 'map': case 'lock': case 'dtd':
				img = 'fa fa-file-code-o';
				break;
				case 'txt': case 'ini': case 'conf': case 'log': case 'htaccess':
				img = 'fa fa-file-text-o';
				break;
				case 'css': case 'less': case 'sass': case 'scss':
				img = 'fa fa-css3';
				break;
				case 'zip': case 'rar': case 'gz': case 'tar': case '7z':
				img = 'fa fa-file-archive-o';
				break;
				case 'php': case 'php4': case 'php5': case 'phps': case 'phtml':
				img = 'fa fa-code';
				break;
				case 'htm': case 'html': case 'shtml': case 'xhtml':
				img = 'fa fa-html5';
				break;
				case 'xml': case 'xsl':
				img = 'fa fa-file-excel-o';
				break;
				case 'wav': case 'mp3': case 'mp2': case 'm4a': case 'aac': case 'ogg':
				case 'oga': case 'wma': case 'mka': case 'flac': case 'ac3': case 'tds':
				img = 'fa fa-music';
				break;
				case 'm3u': case 'm3u8': case 'pls': case 'cue':
				img = 'fa fa-headphones';
				break;
				case 'avi': case 'mpg': case 'mpeg': case 'mp4': case 'm4v': case 'flv':
				case 'f4v': case 'ogm': case 'ogv': case 'mov': case 'mkv': case '3gp':
				case 'asf': case 'wmv':
				img = 'fa fa-file-video-o';
				break;
				case 'eml': case 'msg':
				img = 'fa fa-envelope-o';
				break;
				case 'xls': case 'xlsx':
				img = 'fa fa-file-excel-o';
				break;
				case 'csv':
				img = 'fa fa-file-text-o';
				break;
				case 'bak':
				img = 'fa fa-clipboard';
				break;
				case 'doc': case 'docx':
				img = 'fa fa-file-word-o';
				break;
				case 'ppt': case 'pptx':
				img = 'fa fa-file-powerpoint-o';
				break;
				case 'ttf': case 'ttc': case 'otf': case 'woff':case 'woff2': case 'eot': case 'fon':
				img = 'fa fa-font';
				break;
				case 'pdf':
				img = 'fa fa-file-pdf-o';
				break;
				case 'psd': case 'ai': case 'eps': case 'fla': case 'swf':
				img = 'fa fa-file-image-o';
				break;
				case 'exe': case 'msi':
				img = 'fa fa-file-o';
				break;
				case 'bat':
				img = 'fa fa-terminal';
				break;
				default:
				img = 'fa fa-info-circle';
			}
			return img;
		}

		function textlimit(string, length = 25, end = "...") {
			if (string.length > length) {
				return string.substring(0, length - end.length) + end;
			} else {
				return string;
			}
		}

		function newfolder() {
			var newfoldername = prompt("New folder name");
			if (newfoldername) {
				console.log(newfoldername + " " + currentPath);
			}
		}


		function loadfiles() {
			skyid.getJSON('index', function(response) {
				if (response == false) {
					files = [
						{"name":"Example folder", "type":"Folder", "size":0, "date":1588126140, "path":"", "url":"", "status":""},
						{"name":"Skynet logo", "type":"png", "size":8, "date":1588126140, "path":"", "url":"https://siasky.net/TAAevO7_r-UG22n7K1IK2N9sTFwVCkolVwWMi2rNilMG5w", "status":""},
						{"name":"Example file", "type":"txt", "size":0, "date":1588126140, "path":"", "url":"", "status":""},
						{"name":"Example file 2", "type":"txt", "size":17, "date":1588126140, "path":"Example folder", "url":"", "status":""}
					]
				} else {
					files = JSON.parse(response)
				}
				getdata()
			})
		}
		</script>
		
	</div>
	<!--   Core JS Files   -->
	<script src="assets/js/core/jquery.min.js" type="text/javascript"></script>
	<script src="assets/js/core/popper.min.js" type="text/javascript"></script>
	<script src="assets/js/core/bootstrap.min.js" type="text/javascript"></script>
	<!-- Control Center for Black UI Kit: parallax effects, scripts for the example pages etc -->
	<script src="assets/js/script.min.js" type="text/javascript"></script>
</body>

</html>